var Fudge;
(function (Fudge) {
    let CONTEXTMENU;
    (function (CONTEXTMENU) {
        // SKETCH = ViewSketch,
        CONTEXTMENU[CONTEXTMENU["ADD_NODE"] = 0] = "ADD_NODE";
        CONTEXTMENU[CONTEXTMENU["ACTIVATE_NODE"] = 1] = "ACTIVATE_NODE";
        CONTEXTMENU[CONTEXTMENU["DELETE_NODE"] = 2] = "DELETE_NODE";
        CONTEXTMENU[CONTEXTMENU["ADD_COMPONENT"] = 3] = "ADD_COMPONENT";
        CONTEXTMENU[CONTEXTMENU["DELETE_COMPONENT"] = 4] = "DELETE_COMPONENT";
        CONTEXTMENU[CONTEXTMENU["ADD_COMPONENT_SCRIPT"] = 5] = "ADD_COMPONENT_SCRIPT";
        CONTEXTMENU[CONTEXTMENU["EDIT"] = 6] = "EDIT";
        CONTEXTMENU[CONTEXTMENU["CREATE_FOLDER"] = 7] = "CREATE_FOLDER";
        CONTEXTMENU[CONTEXTMENU["CREATE_MESH"] = 8] = "CREATE_MESH";
        CONTEXTMENU[CONTEXTMENU["CREATE_MATERIAL"] = 9] = "CREATE_MATERIAL";
        CONTEXTMENU[CONTEXTMENU["CREATE_GRAPH"] = 10] = "CREATE_GRAPH";
        CONTEXTMENU[CONTEXTMENU["CREATE_ANIMATION"] = 11] = "CREATE_ANIMATION";
        CONTEXTMENU[CONTEXTMENU["CREATE_PARTICLE_EFFECT"] = 12] = "CREATE_PARTICLE_EFFECT";
        CONTEXTMENU[CONTEXTMENU["SYNC_INSTANCES"] = 13] = "SYNC_INSTANCES";
        CONTEXTMENU[CONTEXTMENU["REMOVE_COMPONENT"] = 14] = "REMOVE_COMPONENT";
        CONTEXTMENU[CONTEXTMENU["ADD_JOINT"] = 15] = "ADD_JOINT";
        CONTEXTMENU[CONTEXTMENU["DELETE_RESOURCE"] = 16] = "DELETE_RESOURCE";
        CONTEXTMENU[CONTEXTMENU["CLONE_RESOURCE"] = 17] = "CLONE_RESOURCE";
        CONTEXTMENU[CONTEXTMENU["ORTHGRAPHIC_CAMERA"] = 18] = "ORTHGRAPHIC_CAMERA";
        CONTEXTMENU[CONTEXTMENU["RENDER_CONTINUOUSLY"] = 19] = "RENDER_CONTINUOUSLY";
        CONTEXTMENU[CONTEXTMENU["SELECTION_OUTLINE"] = 20] = "SELECTION_OUTLINE";
        CONTEXTMENU[CONTEXTMENU["ADD_PROPERTY"] = 21] = "ADD_PROPERTY";
        CONTEXTMENU[CONTEXTMENU["DELETE_PROPERTY"] = 22] = "DELETE_PROPERTY";
        CONTEXTMENU[CONTEXTMENU["CONVERT_ANIMATION"] = 23] = "CONVERT_ANIMATION";
        CONTEXTMENU[CONTEXTMENU["ADD_PARTICLE_PROPERTY"] = 24] = "ADD_PARTICLE_PROPERTY";
        CONTEXTMENU[CONTEXTMENU["ADD_PARTICLE_FUNCTION"] = 25] = "ADD_PARTICLE_FUNCTION";
        CONTEXTMENU[CONTEXTMENU["ADD_PARTICLE_CONSTANT"] = 26] = "ADD_PARTICLE_CONSTANT";
        CONTEXTMENU[CONTEXTMENU["ADD_PARTICLE_CODE"] = 27] = "ADD_PARTICLE_CODE";
        CONTEXTMENU[CONTEXTMENU["ADD_PARTICLE_TRANSFORMATION"] = 28] = "ADD_PARTICLE_TRANSFORMATION";
        CONTEXTMENU[CONTEXTMENU["DELETE_PARTICLE_DATA"] = 29] = "DELETE_PARTICLE_DATA";
    })(CONTEXTMENU = Fudge.CONTEXTMENU || (Fudge.CONTEXTMENU = {}));
    let MENU;
    (function (MENU) {
        MENU["QUIT"] = "quit";
        MENU["PROJECT_NEW"] = "projectNew";
        MENU["PROJECT_SAVE"] = "projectSave";
        MENU["PROJECT_LOAD"] = "projectLoad";
        MENU["DEVTOOLS_OPEN"] = "devtoolsOpen";
        MENU["PANEL_GRAPH_OPEN"] = "panelGraphOpen";
        MENU["PANEL_ANIMATION_OPEN"] = "panelAnimationOpen";
        MENU["PANEL_PROJECT_OPEN"] = "panelProjectOpen";
        MENU["PANEL_HELP_OPEN"] = "panelHelpOpen";
        MENU["PANEL_PARTICLE_SYSTEM_OPEN"] = "panelParticleSystemOpen";
        MENU["FULLSCREEN"] = "fullscreen";
        MENU["ZOOM_IN"] = "zoomIn";
        MENU["ZOOM_OUT"] = "zoomOut";
        MENU["ZOOM_RESET"] = "zoomReset";
    })(MENU = Fudge.MENU || (Fudge.MENU = {}));
    let PANEL;
    (function (PANEL) {
        PANEL["GRAPH"] = "PanelGraph";
        PANEL["PROJECT"] = "PanelProject";
        PANEL["HELP"] = "PanelHelp";
        PANEL["ANIMATION"] = "PanelAnimation";
        PANEL["PARTICLE_SYSTEM"] = "PanelParticleSystem";
    })(PANEL = Fudge.PANEL || (Fudge.PANEL = {}));
    let VIEW;
    (function (VIEW) {
        VIEW["HIERARCHY"] = "ViewHierarchy";
        VIEW["ANIMATION"] = "ViewAnimation";
        VIEW["ANIMATION_SHEET"] = "ViewAnimationSheet";
        VIEW["RENDER"] = "ViewRender";
        VIEW["COMPONENTS"] = "ViewComponents";
        VIEW["CAMERA"] = "ViewCamera";
        VIEW["INTERNAL_TABLE"] = "ViewInternalTable";
        VIEW["INTERNAL_FOLDER"] = "ViewInternalFolder";
        VIEW["EXTERNAL"] = "ViewExternal";
        VIEW["PROPERTIES"] = "ViewProperties";
        VIEW["PREVIEW"] = "ViewPreview";
        VIEW["SCRIPT"] = "ViewScript";
        VIEW["PARTICLE_SYSTEM"] = "ViewParticleSystem";
        // SKETCH = ViewSketch,
        // MESH = ViewMesh,
    })(VIEW = Fudge.VIEW || (Fudge.VIEW = {}));
    let TRANSFORM;
    (function (TRANSFORM) {
        TRANSFORM["NONE"] = "none";
        TRANSFORM["TRANSLATE"] = "translate";
        TRANSFORM["ROTATE"] = "rotate";
        TRANSFORM["SCALE"] = "scale";
        TRANSFORM["WORLD"] = "world";
        TRANSFORM["LOCAL"] = "local";
    })(TRANSFORM = Fudge.TRANSFORM || (Fudge.TRANSFORM = {}));
})(Fudge || (Fudge = {}));
///<reference types="../../node_modules/electron"/>
/**
 * Main electron application running node. Starts the browser window to contain Fudge and sets up the main menu.
 * See subfolder Fudge for most of the other functionality
 */
var Main;
///<reference types="../../node_modules/electron"/>
/**
 * Main electron application running node. Starts the browser window to contain Fudge and sets up the main menu.
 * See subfolder Fudge for most of the other functionality
 */
(function (Main) {
    //#region Types and Data
    // eslint-disable-next-line @typescript-eslint/naming-convention
    const { app, BrowserWindow, Menu, ipcMain } = require("electron");
    const { join } = require("path");
    // couldn't find type in electron d.ts file
    const remote = require("@electron/remote/main");
    remote.initialize();
    let fudge;
    let defaultWidth = 800;
    let defaultHeight = 600;
    let saved = false;
    //#endregion
    // app.commandLine.appendSwitch("autoplay-policy", "no-user-gesture-required");
    //#region Events 
    app.addListener("ready", createFudge);
    app.addListener("activate", function () {
        console.log("Activate");
        if (fudge === null)
            createFudge();
    });
    ipcMain.addListener("enableMenuItem", function (_event, _args) {
        Menu.getApplicationMenu().getMenuItemById(_args["item"]).enabled = _args["on"];
    });
    function quit(_event) {
        if (!saved) {
            if ("type" in _event)
                console.log("Trying to save state!", _event.type);
            // _event.preventDefault();
            send(fudge, Fudge.MENU.QUIT);
            saved = true;
            if (process.platform !== "darwin")
                app.quit();
        }
    }
    function send(_window, _message, ..._args) {
        console.log(`Send message ${_message}`);
        _window.webContents.send(_message, _args);
    }
    //#endregion
    //#region Window
    function createFudge() {
        console.log("createFudge");
        fudge = addWindow("../Html/Fudge.html");
        const menu = Menu.buildFromTemplate(getMenuFudge());
        // fudge.setMenu(menu);
        Menu.setApplicationMenu(menu);
        fudge.on("close", quit);
    }
    function addWindow(_url, _width = defaultWidth, _height = defaultHeight) {
        let window = new BrowserWindow({
            width: _width,
            height: _height,
            icon: join(__dirname, "../Html/Image/Logo64.png"),
            // fullscreen: true,
            webPreferences: {
                nodeIntegration: true,
                contextIsolation: false
            }
        });
        remote.enable(window.webContents);
        window.webContents.openDevTools();
        window.loadFile(_url);
        window.maximize();
        return window;
    }
    // #endregion
    //#region Menus  
    function menuSelect(_item, _window, _event) {
        console.log(`MenuSelect: Item-id=${Fudge.MENU[_item.id]}`);
        // TODO: simplify switch using enums as messages
        const webContents = _window.webContents;
        const zoomLevel = webContents.getZoomLevel();
        switch (_item.id) {
            case Fudge.MENU.DEVTOOLS_OPEN:
                _window.webContents.openDevTools();
                break;
            case Fudge.MENU.FULLSCREEN:
                _window.fullScreen = !_window.isFullScreen();
                break;
            case Fudge.MENU.ZOOM_IN:
                webContents.setZoomLevel(zoomLevel + 1);
                break;
            case Fudge.MENU.ZOOM_OUT:
                webContents.setZoomLevel(zoomLevel - 1);
                break;
            case Fudge.MENU.ZOOM_RESET:
                webContents.setZoomLevel(0);
                break;
            case Fudge.MENU.QUIT:
                quit({ type: "Ctrl+Q" });
                break;
            default:
                send(_window, _item.id, null);
                break;
        }
    }
    function getMenuFudge() {
        const menu = [
            {
                label: "Project", submenu: [
                    { label: "New", id: Fudge.MENU.PROJECT_NEW, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+N" : "Ctrl+N" },
                    { label: "Load", id: Fudge.MENU.PROJECT_LOAD, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+L" : "Ctrl+L" },
                    { label: "Save", id: Fudge.MENU.PROJECT_SAVE, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+S" : "Ctrl+S", enabled: false },
                    { label: "Quit", id: Fudge.MENU.QUIT, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+Q" : "Ctrl+Q" }
                ]
            },
            {
                label: "Panel", submenu: [
                    { label: "Help", id: Fudge.MENU.PANEL_HELP_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+H" : "Ctrl+H", enabled: true },
                    { label: "Project", id: Fudge.MENU.PANEL_PROJECT_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+R" : "Ctrl+R", enabled: false },
                    { label: "Graph", id: Fudge.MENU.PANEL_GRAPH_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+G" : "Ctrl+G", enabled: false },
                    { label: "Animation", id: Fudge.MENU.PANEL_ANIMATION_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "Command+I" : "Ctrl+I", enabled: false },
                    { label: "Particle System", id: Fudge.MENU.PANEL_PARTICLE_SYSTEM_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "" : "", enabled: false }
                ]
            },
            {
                label: "Debug", submenu: [
                    { label: "DevTool", id: Fudge.MENU.DEVTOOLS_OPEN, click: menuSelect, accelerator: process.platform == "darwin" ? "F12" : "F12" },
                    { label: "Fullscreen", id: Fudge.MENU.FULLSCREEN, click: menuSelect, accelerator: process.platform == "darwin" ? "F11" : "F11" },
                    { label: "Zoom In", id: Fudge.MENU.ZOOM_IN, click: menuSelect, accelerator: process.platform === "darwin" ? "Command+=" : "Ctrl+=" },
                    { label: "Zoom Out", id: Fudge.MENU.ZOOM_OUT, click: menuSelect, accelerator: process.platform === "darwin" ? "Command+-" : "Ctrl+-" },
                    { label: "Reset Zoom", id: Fudge.MENU.ZOOM_RESET, click: menuSelect, accelerator: process.platform === "darwin" ? "Command+0" : "Ctrl+0" }
                ]
            }
        ];
        return menu;
    }
    // #endregion
})(Main || (Main = {}));
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiTWFpbi5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL1NvdXJjZS9GdWRnZS9EZWZpbml0aW9uLnRzIiwiLi4vU291cmNlL01haW4udHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBVSxLQUFLLENBd0ZkO0FBeEZELFdBQVUsS0FBSztJQUNiLElBQVksV0FnQ1g7SUFoQ0QsV0FBWSxXQUFXO1FBQ3JCLHVCQUF1QjtRQUN2QixxREFBUSxDQUFBO1FBQ1IsK0RBQWEsQ0FBQTtRQUNiLDJEQUFXLENBQUE7UUFDWCwrREFBYSxDQUFBO1FBQ2IscUVBQWdCLENBQUE7UUFDaEIsNkVBQW9CLENBQUE7UUFDcEIsNkNBQUksQ0FBQTtRQUNKLCtEQUFhLENBQUE7UUFDYiwyREFBVyxDQUFBO1FBQ1gsbUVBQWUsQ0FBQTtRQUNmLDhEQUFZLENBQUE7UUFDWixzRUFBZ0IsQ0FBQTtRQUNoQixrRkFBc0IsQ0FBQTtRQUN0QixrRUFBYyxDQUFBO1FBQ2Qsc0VBQWdCLENBQUE7UUFDaEIsd0RBQVMsQ0FBQTtRQUNULG9FQUFlLENBQUE7UUFDZixrRUFBYyxDQUFBO1FBQ2QsMEVBQWtCLENBQUE7UUFDbEIsNEVBQW1CLENBQUE7UUFDbkIsd0VBQWlCLENBQUE7UUFDakIsOERBQVksQ0FBQTtRQUNaLG9FQUFlLENBQUE7UUFDZix3RUFBaUIsQ0FBQTtRQUNqQixnRkFBcUIsQ0FBQTtRQUNyQixnRkFBcUIsQ0FBQTtRQUNyQixnRkFBcUIsQ0FBQTtRQUNyQix3RUFBaUIsQ0FBQTtRQUNqQiw0RkFBMkIsQ0FBQTtRQUMzQiw4RUFBb0IsQ0FBQTtJQUN0QixDQUFDLEVBaENXLFdBQVcsR0FBWCxpQkFBVyxLQUFYLGlCQUFXLFFBZ0N0QjtJQUdELElBQVksSUFlWDtJQWZELFdBQVksSUFBSTtRQUNkLHFCQUFhLENBQUE7UUFDYixrQ0FBMEIsQ0FBQTtRQUMxQixvQ0FBNEIsQ0FBQTtRQUM1QixvQ0FBNEIsQ0FBQTtRQUM1QixzQ0FBOEIsQ0FBQTtRQUM5Qiwy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QUUsRUFBRSxFQUFFLEtBQUssQ0FBQyxJQUFJLENBQUMsT0FBTyxFQUFFLEtBQUssRUFBRSxVQUFVLEVBQUUsV0FBVyxFQUFFLE9BQU8sQ0FBQyxRQUFRLEtBQUssUUFBUSxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRTtvQkFDcEksRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLEVBQUUsRUFBRSxLQUFLLENBQUMsSUFBSSxDQUFDLFFBQVEsRUFBRSxLQUFLLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxPQUFPLENBQUMsUUFBUSxLQUFLLFFBQVEsQ0FBQyxDQUFDLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUU7b0JBQ3RJLEVBQUUsS0FBSyxFQUFFLFlBQVksRUFBRSxFQUFFLEVBQUUsS0FBSyxDQUFDLElBQUksQ0FBQyxVQUFVLEVBQUUsS0FBSyxFQUFFLFVBQVUsRUFBRSxXQUFXLEVBQUUsT0FBTyxDQUFDLFFBQVEsS0FBSyxRQUFRLENBQUMsQ0FBQyxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsUUFBUSxFQUFFO2lCQUMzSTthQUNGO1NBQUMsQ0FBQztRQUNMLE9BQU8sSUFBSSxDQUFDO0lBQ2QsQ0FBQztJQUNELGFBQWE7QUFDZixDQUFDLEVBL0lTLElBQUksS0FBSixJQUFJLFFBK0liIiwic291cmNlc0NvbnRlbnQiOlsibmFtZXNwYWNlIEZ1ZGdlIHtcclxuICBleHBvcnQgZW51bSBDT05URVhUTUVOVSB7XHJcbiAgICAvLyBTS0VUQ0ggPSBWaWV3U2tldGNoLFxyXG4gICAgQUREX05PREUsXHJcbiAgICBBQ1RJVkFURV9OT0RFLFxyXG4gICAgREVMRVRFX05PREUsXHJcbiAgICBBRERfQ09NUE9ORU5ULFxyXG4gICAgREVMRVRFX0NPTVBPTkVOVCxcclxuICAgIEFERF9DT01QT05FTlRfU0NSSVBULFxyXG4gICAgRURJVCxcclxuICAgIENSRUFURV9GT0xERVIsXHJcbiAgICBDUkVBVEVfTUVTSCxcclxuICAgIENSRUFURV9NQVRFUklBTCxcclxuICAgIENSRUFURV9HUkFQSCxcclxuICAgIENSRUFURV9BTklNQVRJT04sXHJcbiAgICBDUkVBVEVfUEFSVElDTEVfRUZGRUNULFxyXG4gICAgU1lOQ19JTlNUQU5DRVMsXHJcbiAgICBSRU1PVkVfQ09NUE9ORU5ULFxyXG4gICAgQUREX0pPSU5ULFxyXG4gICAgREVMRVRFX1JFU09VUkNFLFxyXG4gICAgQ0xPTkVfUkVTT1VSQ0UsXHJcbiAgICBPUlRIR1JBUEhJQ19DQU1FUkEsXHJcbiAgICBSRU5ERVJfQ09OVElOVU9VU0xZLFxyXG4gICAgU0VMRUNUSU9OX09VVExJTkUsXHJcbiAgICBBRERfUFJPUEVSVFksXHJcbiAgICBERUxFVEVfUFJPUEVSVFksXHJcbiAgICBDT05WRVJUX0FOSU1BVElPTixcclxuICAgIEFERF9QQVJUSUNMRV9QUk9QRVJUWSxcclxuICAgIEFERF9QQVJUSUNMRV9GVU5DVElPTixcclxuICAgIEFERF9QQVJUSUNMRV9DT05TVEFOVCxcclxuICAgIEFERF9QQVJUSUNMRV9DT0RFLFxyXG4gICAgQUREX1BBUlRJQ0xFX1RSQU5TRk9STUFUSU9OLFxyXG4gICAgREVMRVRFX1BBUlRJQ0xFX0RBVEFcclxuICB9XHJcblxyXG5cclxuICBleHBvcnQgZW51bSBNRU5VIHtcclxuICAgIFFVSVQgPSBcInF1aXRcIixcclxuICAgIFBST0pFQ1RfTkVXID0gXCJwcm9qZWN0TmV3XCIsXHJcbiAgICBQUk9KRUNUX1NBVkUgPSBcInByb2plY3RTYXZlXCIsXHJcbiAgICBQUk9KRUNUX0xPQUQgPSBcInByb2plY3RMb2FkXCIsXHJcbiAgICBERVZUT09MU19PUEVOID0gXCJkZXZ0b29sc09wZW5cIixcclxuICAgIFBBTkVMX0dSQVBIX09QRU4gPSBcInBhbmVsR3JhcGhPcGVuXCIsXHJcbiAgICBQQU5FTF9BTklNQVRJT05fT1BFTiA9IFwicGFuZWxBbmltYXRpb25PcGVuXCIsXHJcbiAgICBQQU5FTF9QUk9KRUNUX09QRU4gPSBcInBhbmVsUHJvamVjdE9wZW5cIixcclxuICAgIFBBTkVMX0hFTFBfT1BFTiA9IFwicGFuZWxIZWxwT3BlblwiLFxyXG4gICAgUEFORUxfUEFSVElDTEVfU1lTVEVNX09QRU4gPSBcInBhbmVsUGFydGljbGVTeXN0ZW1PcGVuXCIsXHJcbiAgICBGVUxMU0NSRUVOID0gXCJmdWxsc2NyZWVuXCIsXHJcbiAgICBaT09NX0lOID0gXCJ6b29tSW5cIixcclxuICAgIFpPT01fT1VUID0gXCJ6b29tT3V0XCIsXHJcbiAgICBaT09NX1JFU0VUID0gXCJ6b29tUmVzZXRcIlxyXG4gIH1cclxuXHJcbiAgZXhwb3J0IGVudW0gUEFORUwge1xyXG4gICAgR1JBUEggPSBcIlBhbmVsR3JhcGhcIixcclxuICAgIFBST0pFQ1QgPSBcIlBhbmVsUHJvamVjdFwiLFxyXG4gICAgSEVMUCA9IFwiUGFuZWxIZWxwXCIsXHJcbiAgICBBTklNQVRJT04gPSBcIlBhbmVsQW5pbWF0aW9uXCIsXHJcbiAgICBQQVJUSUNMRV9TWVNURU0gPSBcIlBhbmVsUGFydGljbGVTeXN0ZW1cIlxyXG5cclxuICB9XHJcblxyXG4gIGV4cG9ydCBlbnVtIFZJRVcge1xyXG4gICAgSElFUkFSQ0hZID0gXCJWaWV3SGllcmFyY2h5XCIsXHJcbiAgICBBTklNQVRJT04gPSBcIlZpZXdBbmltYXRpb25cIixcclxuICAgIEFOSU1BVElPTl9TSEVFVCA9IFwiVmlld0FuaW1hdGlvblNoZWV0XCIsXHJcbiAgICBSRU5ERVIgPSBcIlZpZXdSZW5kZXJcIixcclxuICAgIENPTVBPTkVOVFMgPSBcIlZpZXdDb21wb25lbnRzXCIsXHJcbiAgICBDQU1FUkEgPSBcIlZpZXdDYW1lcmFcIixcclxuICAgIElOVEVSTkFMX1RBQkxFID0gXCJWaWV3SW50ZXJuYWxUYWJsZVwiLFxyXG4gICAgSU5URVJOQUxfRk9MREVSID0gXCJWaWV3SW50ZXJuYWxGb2xkZXJcIixcclxuICAgIEVYVEVSTkFMID0gXCJWaWV3RXh0ZXJuYWxcIixcclxuICAgIFBST1BFUlRJRVMgPSBcIlZpZXdQcm9wZXJ0aWVzXCIsXHJcbiAgICBQUkVWSUVXID0gXCJWaWV3UHJldmlld1wiLFxyXG4gICAgU0NSSVBUID0gXCJWaWV3U2NyaXB0XCIsXHJcbiAgICBQQVJUSUNMRV9TWVNURU0gPSBcIlZpZXdQYXJ0aWNsZVN5c3RlbVwiXHJcbiAgICAvLyBTS0VUQ0ggPSBWaWV3U2tldGNoLFxyXG4gICAgLy8gTUVTSCA9IFZpZXdNZXNoLFxyXG4gIH1cclxuXHJcbiAgZXhwb3J0IGVudW0gVFJBTlNGT1JNIHtcclxuICAgIE5PTkUgPSBcIm5vbmVcIixcclxuICAgIFRSQU5TTEFURSA9IFwidHJhbnNsYXRlXCIsXHJcbiAgICBST1RBVEUgPSBcInJvdGF0ZVwiLFxyXG4gICAgU0NBTEUgPSBcInNjYWxlXCIsXHJcbiAgICBXT1JMRCA9IFwid29ybGRcIixcclxuICAgIExPQ0FMID0gXCJsb2NhbFwiXHJcbiAgfVxyXG59IiwiLy8vPHJlZmVyZW5jZSB0eXBlcz1cIi4uLy4uL25vZGVfbW9kdWxlcy9lbGVjdHJvblwiLz5cclxuXHJcbi8qKlxyXG4gKiBNYWluIGVsZWN0cm9uIGFwcGxpY2F0aW9uIHJ1bm5pbmcgbm9kZS4gU3RhcnRzIHRoZSBicm93c2VyIHdpbmRvdyB0byBjb250YWluIEZ1ZGdlIGFuZCBzZXRzIHVwIHRoZSBtYWluIG1lbnUuXHJcbiAqIFNlZSBzdWJmb2xkZXIgRnVkZ2UgZm9yIG1vc3Qgb2YgdGhlIG90aGVyIGZ1bmN0aW9uYWxpdHlcclxuICovXHJcbm5hbWVzcGFjZSBNYWluIHtcclxuICAvLyNyZWdpb24gVHlwZXMgYW5kIERhdGFcclxuXHJcbiAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uYW1pbmctY29udmVudGlvblxyXG4gIGNvbnN0IHsgYXBwLCBCcm93c2VyV2luZG93LCBNZW51LCBpcGNNYWluIH0gPSByZXF1aXJlKFwiZWxlY3Ryb25cIik7XHJcbiAgY29uc3QgeyBqb2luIH0gPSA8dHlwZW9mIGltcG9ydChcInBhdGhcIik+cmVxdWlyZShcInBhdGhcIik7XHJcblxyXG4gIC8vIGNvdWxkbid0IGZpbmQgdHlwZSBpbiBlbGVjdHJvbiBkLnRzIGZpbGVcclxuICBjb25zdCByZW1vdGU6IHsgaW5pdGlhbGl6ZTogKCkgPT4gdm9pZDsgZW5hYmxlOiAoY29udGVudHM6IEVsZWN0cm9uLldlYkNvbnRlbnRzKSA9PiB2b2lkIH0gPSByZXF1aXJlKFwiQGVsZWN0cm9uL3JlbW90ZS9tYWluXCIpO1xyXG5cclxuICByZW1vdGUuaW5pdGlhbGl6ZSgpO1xyXG5cclxuICBsZXQgZnVkZ2U6IEVsZWN0cm9uLkJyb3dzZXJXaW5kb3c7XHJcbiAgbGV0IGRlZmF1bHRXaWR0aDogbnVtYmVyID0gODAwO1xyXG4gIGxldCBkZWZhdWx0SGVpZ2h0OiBudW1iZXIgPSA2MDA7XHJcbiAgbGV0IHNhdmVkOiBib29sZWFuID0gZmFsc2U7XHJcbiAgLy8jZW5kcmVnaW9uXHJcblxyXG4gIC8vIGFwcC5jb21tYW5kTGluZS5hcHBlbmRTd2l0Y2goXCJhdXRvcGxheS1wb2xpY3lcIiwgXCJuby11c2VyLWdlc3R1cmUtcmVxdWlyZWRcIik7XHJcblxyXG4gIC8vI3JlZ2lvbiBFdmVudHMgXHJcbiAgYXBwLmFkZExpc3RlbmVyKFwicmVhZHlcIiwgY3JlYXRlRnVkZ2UpO1xyXG4gIGFwcC5hZGRMaXN0ZW5lcihcImFjdGl2YXRlXCIsIGZ1bmN0aW9uICgpOiB2b2lkIHtcclxuICAgIGNvbnNvbGUubG9nKFwiQWN0aXZhdGVcIik7XHJcbiAgICBpZiAoZnVkZ2UgPT09IG51bGwpIGNyZWF0ZUZ1ZGdlKCk7XHJcbiAgfSk7XHJcblxyXG4gIGlwY01haW4uYWRkTGlzdGVuZXIoXCJlbmFibGVNZW51SXRlbVwiLCBmdW5jdGlvbiAoX2V2ZW50OiBFbGVjdHJvbi5FdmVudCwgX2FyZ3M6IE9iamVjdCk6IHZvaWQge1xyXG4gICAgTWVudS5nZXRBcHBsaWNhdGlvbk1lbnUoKS5nZXRNZW51SXRlbUJ5SWQoX2FyZ3NbXCJpdGVtXCJdKS5lbmFibGVkID0gX2FyZ3NbXCJvblwiXTtcclxuICB9KTtcclxuXHJcbiAgZnVuY3Rpb24gcXVpdChfZXZlbnQ6IEVsZWN0cm9uLkV2ZW50IHwgeyB0eXBlOiBzdHJpbmcgfSk6IHZvaWQge1xyXG4gICAgaWYgKCFzYXZlZCkge1xyXG4gICAgICBpZiAoXCJ0eXBlXCIgaW4gX2V2ZW50KVxyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiVHJ5aW5nIHRvIHNhdmUgc3RhdGUhXCIsIF9ldmVudC50eXBlKTtcclxuICAgICAgLy8gX2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHNlbmQoZnVkZ2UsIEZ1ZGdlLk1FTlUuUVVJVCk7XHJcbiAgICAgIHNhdmVkID0gdHJ1ZTtcclxuICAgICAgaWYgKHByb2Nlc3MucGxhdGZvcm0gIT09IFwiZGFyd2luXCIpXHJcbiAgICAgICAgYXBwLnF1aXQoKTtcclxuICAgIH1cclxuICB9XHJcblxyXG4gIGZ1bmN0aW9uIHNlbmQoX3dpbmRvdzogRWxlY3Ryb24uQnJvd3NlcldpbmRvdywgX21lc3NhZ2U6IHN0cmluZywgLi4uX2FyZ3M6IHVua25vd25bXSk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coYFNlbmQgbWVzc2FnZSAke19tZXNzYWdlfWApO1xyXG4gICAgX3dpbmRvdy53ZWJDb250ZW50cy5zZW5kKF9tZXNzYWdlLCBfYXJncyk7XHJcbiAgfVxyXG4gIC8vI2VuZHJlZ2lvblxyXG5cclxuICAvLyNyZWdpb24gV2luZG93XHJcbiAgZnVuY3Rpb24gY3JlYXRlRnVkZ2UoKTogdm9pZCB7XHJcbiAgICBjb25zb2xlLmxvZyhcImNyZWF0ZUZ1ZGdlXCIpO1xyXG4gICAgZnVkZ2UgPSBhZGRXaW5kb3coXCIuLi9IdG1sL0Z1ZGdlLmh0bWxcIik7XHJcbiAgICBjb25zdCBtZW51OiBFbGVjdHJvbi5NZW51ID0gTWVudS5idWlsZEZyb21UZW1wbGF0ZShnZXRNZW51RnVkZ2UoKSk7XHJcbiAgICAvLyBmdWRnZS5zZXRNZW51KG1lbnUpO1xyXG4gICAgTWVudS5zZXRBcHBsaWNhdGlvbk1lbnUobWVudSk7XHJcbiAgICBmdWRnZS5vbihcImNsb3NlXCIsIHF1aXQpO1xyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gYWRkV2luZG93KF91cmw6IHN0cmluZywgX3dpZHRoOiBudW1iZXIgPSBkZWZhdWx0V2lkdGgsIF9oZWlnaHQ6IG51bWJlciA9IGRlZmF1bHRIZWlnaHQpOiBFbGVjdHJvbi5Ccm93c2VyV2luZG93IHtcclxuICAgIGxldCB3aW5kb3c6IEVsZWN0cm9uLkJyb3dzZXJXaW5kb3cgPSBuZXcgQnJvd3NlcldpbmRvdyh7XHJcbiAgICAgIHdpZHRoOiBfd2lkdGgsXHJcbiAgICAgIGhlaWdodDogX2hlaWdodCxcclxuICAgICAgaWNvbjogam9pbihfX2Rpcm5hbWUsIFwiLi4vSHRtbC9JbWFnZS9Mb2dvNjQucG5nXCIpLFxyXG4gICAgICAvLyBmdWxsc2NyZWVuOiB0cnVlLFxyXG4gICAgICB3ZWJQcmVmZXJlbmNlczogeyAgICAgICAgLy8gcHJlbG9hZDogcGF0aC5qb2luKF9fZGlybmFtZSwgXCJwcmVsb2FkLmpzXCIpLFxyXG4gICAgICAgIG5vZGVJbnRlZ3JhdGlvbjogdHJ1ZSxcclxuICAgICAgICBjb250ZXh0SXNvbGF0aW9uOiBmYWxzZVxyXG4gICAgICB9XHJcbiAgICB9KTtcclxuXHJcbiAgICByZW1vdGUuZW5hYmxlKHdpbmRvdy53ZWJDb250ZW50cyk7XHJcblxyXG4gICAgd2luZG93LndlYkNvbnRlbnRzLm9wZW5EZXZUb29scygpO1xyXG4gICAgd2luZG93LmxvYWRGaWxlKF91cmwpO1xyXG4gICAgd2luZG93Lm1heGltaXplKCk7XHJcbiAgICByZXR1cm4gd2luZG93O1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcblxyXG4gIC8vI3JlZ2lvbiBNZW51cyAgXHJcbiAgZnVuY3Rpb24gbWVudVNlbGVjdChfaXRlbTogRWxlY3Ryb24uTWVudUl0ZW0sIF93aW5kb3c6IEVsZWN0cm9uLkJyb3dzZXJXaW5kb3csIF9ldmVudDogRWxlY3Ryb24uS2V5Ym9hcmRFdmVudCk6IHZvaWQge1xyXG4gICAgY29uc29sZS5sb2coYE1lbnVTZWxlY3Q6IEl0ZW0taWQ9JHtGdWRnZS5NRU5VW19pdGVtLmlkXX1gKTtcclxuICAgIC8vIFRPRE86IHNpbXBsaWZ5IHN3aXRjaCB1c2luZyBlbnVtcyBhcyBtZXNzYWdlc1xyXG4gICAgY29uc3Qgd2ViQ29udGVudHM6IEVsZWN0cm9uLldlYkNvbnRlbnRzID0gX3dpbmRvdy53ZWJDb250ZW50cztcclxuICAgIGNvbnN0IHpvb21MZXZlbDogbnVtYmVyID0gd2ViQ29udGVudHMuZ2V0Wm9vbUxldmVsKCk7XHJcblxyXG4gICAgc3dpdGNoIChfaXRlbS5pZCkge1xyXG4gICAgICBjYXNlIEZ1ZGdlLk1FTlUuREVWVE9PTFNfT1BFTjpcclxuICAgICAgICBfd2luZG93LndlYkNvbnRlbnRzLm9wZW5EZXZUb29scygpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIEZ1ZGdlLk1FTlUuRlVMTFNDUkVFTjpcclxuICAgICAgICBfd2luZG93LmZ1bGxTY3JlZW4gPSAhX3dpbmRvdy5pc0Z1bGxTY3JlZW4oKTtcclxuICAgICAgICBicmVhaztcclxuICAgICAgY2FzZSBGdWRnZS5NRU5VLlpPT01fSU46XHJcbiAgICAgICAgd2ViQ29udGVudHMuc2V0Wm9vbUxldmVsKHpvb21MZXZlbCArIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIEZ1ZGdlLk1FTlUuWk9PTV9PVVQ6XHJcbiAgICAgICAgd2ViQ29udGVudHMuc2V0Wm9vbUxldmVsKHpvb21MZXZlbCAtIDEpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBjYXNlIEZ1ZGdlLk1FTlUuWk9PTV9SRVNFVDpcclxuICAgICAgICB3ZWJDb250ZW50cy5zZXRab29tTGV2ZWwoMCk7XHJcbiAgICAgICAgYnJlYWs7XHJcbiAgICAgIGNhc2UgRnVkZ2UuTUVOVS5RVUlUOlxyXG4gICAgICAgIHF1aXQoeyB0eXBlOiBcIkN0cmwrUVwiIH0pO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgICBkZWZhdWx0OlxyXG4gICAgICAgIHNlbmQoX3dpbmRvdywgX2l0ZW0uaWQsIG51bGwpO1xyXG4gICAgICAgIGJyZWFrO1xyXG4gICAgfVxyXG4gIH1cclxuXHJcbiAgZnVuY3Rpb24gZ2V0TWVudUZ1ZGdlKCk6IEVsZWN0cm9uLk1lbnVJdGVtQ29uc3RydWN0b3JPcHRpb25zW10ge1xyXG4gICAgY29uc3QgbWVudTogRWxlY3Ryb24uTWVudUl0ZW1Db25zdHJ1Y3Rvck9wdGlvbnNbXSA9IFtcclxuICAgICAge1xyXG4gICAgICAgIGxhYmVsOiBcIlByb2plY3RcIiwgc3VibWVudTogW1xyXG4gICAgICAgICAgeyBsYWJlbDogXCJOZXdcIiwgaWQ6IEZ1ZGdlLk1FTlUuUFJPSkVDVF9ORVcsIGNsaWNrOiBtZW51U2VsZWN0LCBhY2NlbGVyYXRvcjogcHJvY2Vzcy5wbGF0Zm9ybSA9PSBcImRhcndpblwiID8gXCJDb21tYW5kK05cIiA6IFwiQ3RybCtOXCIgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiTG9hZFwiLCBpZDogRnVkZ2UuTUVOVS5QUk9KRUNUX0xPQUQsIGNsaWNrOiBtZW51U2VsZWN0LCBhY2NlbGVyYXRvcjogcHJvY2Vzcy5wbGF0Zm9ybSA9PSBcImRhcndpblwiID8gXCJDb21tYW5kK0xcIiA6IFwiQ3RybCtMXCIgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiU2F2ZVwiLCBpZDogRnVkZ2UuTUVOVS5QUk9KRUNUX1NBVkUsIGNsaWNrOiBtZW51U2VsZWN0LCBhY2NlbGVyYXRvcjogcHJvY2Vzcy5wbGF0Zm9ybSA9PSBcImRhcndpblwiID8gXCJDb21tYW5kK1NcIiA6IFwiQ3RybCtTXCIsIGVuYWJsZWQ6IGZhbHNlIH0sXHJcbiAgICAgICAgICB7IGxhYmVsOiBcIlF1aXRcIiwgaWQ6IEZ1ZGdlLk1FTlUuUVVJVCwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrUVwiIDogXCJDdHJsK1FcIiB9XHJcbiAgICAgICAgXVxyXG4gICAgICB9LFxyXG4gICAgICB7XHJcbiAgICAgICAgbGFiZWw6IFwiUGFuZWxcIiwgc3VibWVudTogW1xyXG4gICAgICAgICAgeyBsYWJlbDogXCJIZWxwXCIsIGlkOiBGdWRnZS5NRU5VLlBBTkVMX0hFTFBfT1BFTiwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrSFwiIDogXCJDdHJsK0hcIiwgZW5hYmxlZDogdHJ1ZSB9LFxyXG4gICAgICAgICAgeyBsYWJlbDogXCJQcm9qZWN0XCIsIGlkOiBGdWRnZS5NRU5VLlBBTkVMX1BST0pFQ1RfT1BFTiwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrUlwiIDogXCJDdHJsK1JcIiwgZW5hYmxlZDogZmFsc2UgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiR3JhcGhcIiwgaWQ6IEZ1ZGdlLk1FTlUuUEFORUxfR1JBUEhfT1BFTiwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrR1wiIDogXCJDdHJsK0dcIiwgZW5hYmxlZDogZmFsc2UgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiQW5pbWF0aW9uXCIsIGlkOiBGdWRnZS5NRU5VLlBBTkVMX0FOSU1BVElPTl9PUEVOLCBjbGljazogbWVudVNlbGVjdCwgYWNjZWxlcmF0b3I6IHByb2Nlc3MucGxhdGZvcm0gPT0gXCJkYXJ3aW5cIiA/IFwiQ29tbWFuZCtJXCIgOiBcIkN0cmwrSVwiLCBlbmFibGVkOiBmYWxzZSB9LFxyXG4gICAgICAgICAgeyBsYWJlbDogXCJQYXJ0aWNsZSBTeXN0ZW1cIiwgaWQ6IEZ1ZGdlLk1FTlUuUEFORUxfUEFSVElDTEVfU1lTVEVNX09QRU4sIGNsaWNrOiBtZW51U2VsZWN0LCBhY2NlbGVyYXRvcjogcHJvY2Vzcy5wbGF0Zm9ybSA9PSBcImRhcndpblwiID8gXCJcIiA6IFwiXCIsIGVuYWJsZWQ6IGZhbHNlIH1cclxuICAgICAgICBdXHJcbiAgICAgIH0sXHJcbiAgICAgIHtcclxuICAgICAgICBsYWJlbDogXCJEZWJ1Z1wiLCBzdWJtZW51OiBbXHJcbiAgICAgICAgICB7IGxhYmVsOiBcIkRldlRvb2xcIiwgaWQ6IEZ1ZGdlLk1FTlUuREVWVE9PTFNfT1BFTiwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09IFwiZGFyd2luXCIgPyBcIkYxMlwiIDogXCJGMTJcIiB9LFxyXG4gICAgICAgICAgeyBsYWJlbDogXCJGdWxsc2NyZWVuXCIsIGlkOiBGdWRnZS5NRU5VLkZVTExTQ1JFRU4sIGNsaWNrOiBtZW51U2VsZWN0LCBhY2NlbGVyYXRvcjogcHJvY2Vzcy5wbGF0Zm9ybSA9PSBcImRhcndpblwiID8gXCJGMTFcIiA6IFwiRjExXCIgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiWm9vbSBJblwiLCBpZDogRnVkZ2UuTUVOVS5aT09NX0lOLCBjbGljazogbWVudVNlbGVjdCwgYWNjZWxlcmF0b3I6IHByb2Nlc3MucGxhdGZvcm0gPT09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrPVwiIDogXCJDdHJsKz1cIiB9LFxyXG4gICAgICAgICAgeyBsYWJlbDogXCJab29tIE91dFwiLCBpZDogRnVkZ2UuTUVOVS5aT09NX09VVCwgY2xpY2s6IG1lbnVTZWxlY3QsIGFjY2VsZXJhdG9yOiBwcm9jZXNzLnBsYXRmb3JtID09PSBcImRhcndpblwiID8gXCJDb21tYW5kKy1cIiA6IFwiQ3RybCstXCIgfSxcclxuICAgICAgICAgIHsgbGFiZWw6IFwiUmVzZXQgWm9vbVwiLCBpZDogRnVkZ2UuTUVOVS5aT09NX1JFU0VULCBjbGljazogbWVudVNlbGVjdCwgYWNjZWxlcmF0b3I6IHByb2Nlc3MucGxhdGZvcm0gPT09IFwiZGFyd2luXCIgPyBcIkNvbW1hbmQrMFwiIDogXCJDdHJsKzBcIiB9XHJcbiAgICAgICAgXVxyXG4gICAgICB9XTtcclxuICAgIHJldHVybiBtZW51O1xyXG4gIH1cclxuICAvLyAjZW5kcmVnaW9uXHJcbn1cclxuIl19